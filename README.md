# ğŸ” P2P åŠ å¯†èŠå¤© - MVP ç‰ˆæœ¬

åŸºäº Chitchatter æ ¸å¿ƒæ¶æ„çš„æœ€å°åŒ–å¯è¡Œäº§å“ï¼ˆMVPï¼‰ï¼Œä½¿ç”¨ Vue3 + TypeScript å®ç°çš„ç«¯åˆ°ç«¯åŠ å¯† P2P èŠå¤©åº”ç”¨ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **ğŸ”’ ç«¯åˆ°ç«¯åŠ å¯†**ï¼šåŸºäº RSA-OAEP åŠ å¯†ç®—æ³•ï¼Œæ¶ˆæ¯ä»…å­˜åœ¨äºé€šä¿¡åŒæ–¹çš„æµè§ˆå™¨ä¸­
- **ğŸŒ ç‚¹å¯¹ç‚¹ç›´è¿**ï¼šä½¿ç”¨ WebRTC æŠ€æœ¯å»ºç«‹ P2P è¿æ¥ï¼Œæ— éœ€ä¸­å¿ƒæœåŠ¡å™¨
- **âš¡ å®æ—¶é€šè®¯**ï¼šåŸºäº Trystero åº“å®ç°çš„é«˜æ•ˆå®æ—¶æ¶ˆæ¯ä¼ è¾“
- **ğŸ’¾ é›¶æœåŠ¡å™¨å­˜å‚¨**ï¼šæ‰€æœ‰æ¶ˆæ¯éƒ½åœ¨å†…å­˜ä¸­ï¼Œå…³é—­æµè§ˆå™¨åè‡ªåŠ¨æ¸…é™¤
- **ğŸ¨ ç°ä»£åŒ– UI**ï¼šå“åº”å¼è®¾è®¡ï¼Œæ”¯æŒå¤šç”¨æˆ·åœ¨çº¿æ˜¾ç¤º

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚ (Vue3)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  App.vue    â”‚              â”‚ ChatRoom.vue â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â”‚      Composable å±‚           â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚           useRoom.ts                      â”‚          â”‚
â”‚  â”‚  - æˆ¿é—´çŠ¶æ€ç®¡ç†                            â”‚          â”‚
â”‚  â”‚  - æ¶ˆæ¯æ”¶å‘                                â”‚          â”‚
â”‚  â”‚  - ç”¨æˆ·ç®¡ç†                                â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â”‚    æ ¸å¿ƒæœåŠ¡å±‚         â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  PeerRoom.ts    â”‚    â”‚ encryption.ts   â”‚            â”‚
â”‚  â”‚  - P2P è¿æ¥     â”‚    â”‚ - RSA åŠ å¯†      â”‚            â”‚
â”‚  â”‚  - æˆ¿é—´ç®¡ç†     â”‚    â”‚ - å¯†é’¥ç®¡ç†      â”‚            â”‚
â”‚  â”‚  - æ¶ˆæ¯é€šé“     â”‚    â”‚ - åŠ è§£å¯†æ“ä½œ    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº•å±‚æŠ€æœ¯æ ˆ                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Trystero   â”‚  â”‚   WebRTC     â”‚  â”‚  Web Crypto  â”‚ â”‚
â”‚  â”‚  P2P è¿æ¥   â”‚  â”‚  å®æ—¶é€šä¿¡    â”‚  â”‚  æµè§ˆå™¨åŠ å¯†  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ å·¥ä½œåŸç†

### 1ï¸âƒ£ **è¿æ¥å»ºç«‹**
```typescript
ç”¨æˆ· A æµè§ˆå™¨ â†’ WebTorrent Tracker â† ç”¨æˆ· B æµè§ˆå™¨
              (é€šè¿‡æˆ¿é—´ ID åŒ¹é…)
```

### 2ï¸âƒ£ **P2P ç›´è¿**
```typescript
ç”¨æˆ· A â†â”€â”€â”€â”€â”€â”€ WebRTC ç›´è¿ â”€â”€â”€â”€â”€â”€â†’ ç”¨æˆ· B
      (å¦‚æœå¤±è´¥ï¼Œä½¿ç”¨ TURN ä¸­ç»§)
```

### 3ï¸âƒ£ **åŠ å¯†é€šä¿¡**
```typescript
ç”¨æˆ· A: ç”Ÿæˆå¯†é’¥å¯¹ â†’ äº¤æ¢å…¬é’¥ â† ç”¨æˆ· B: ç”Ÿæˆå¯†é’¥å¯¹
ç”¨æˆ· A: ç”¨ B çš„å…¬é’¥åŠ å¯† â†’ å‘é€ â†’ ç”¨ B çš„ç§é’¥è§£å¯†
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–
```bash
npm install
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```bash
npm run build
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
chat-p2p/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # Vue ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ChatRoom.vue     # èŠå¤©å®¤ä¸»ç•Œé¢
â”‚   â”œâ”€â”€ composables/         # Vue3 Composables
â”‚   â”‚   â””â”€â”€ useRoom.ts       # æˆ¿é—´é€»è¾‘ç®¡ç†
â”‚   â”œâ”€â”€ lib/                 # æ ¸å¿ƒåº“
â”‚   â”‚   â””â”€â”€ PeerRoom.ts      # P2P æˆ¿é—´ç±»
â”‚   â”œâ”€â”€ services/            # æœåŠ¡å±‚
â”‚   â”‚   â””â”€â”€ encryption.ts    # åŠ å¯†æœåŠ¡
â”‚   â”œâ”€â”€ config/              # é…ç½®
â”‚   â”‚   â””â”€â”€ rtc.ts           # WebRTC é…ç½®
â”‚   â””â”€â”€ App.vue              # åº”ç”¨å…¥å£
â”œâ”€â”€ package.json
â””â”€â”€ vite.config.ts
```

## ğŸ”‘ æ ¸å¿ƒç±»è¯´æ˜

### `PeerRoom` - P2P æˆ¿é—´ç®¡ç†å™¨
```typescript
class PeerRoom {
  constructor(roomId: string, config?: RoomConfig)
  onPeerJoin(handler: (peerId: string) => void)
  onPeerLeave(handler: (peerId: string) => void)
  createMessageAction(): { sendMessage, onMessage }
  createMetadataAction(): { sendMetadata, onMetadata }
  getPeers(): string[]
  leave(): void
}
```

### `EncryptionService` - åŠ å¯†æœåŠ¡
```typescript
class EncryptionService {
  generateKeyPair(): Promise<CryptoKeyPair>
  stringifyCryptoKey(key: CryptoKey): Promise<string>
  parseCryptoKey(keyString: string, type: 'public' | 'private'): Promise<CryptoKey>
  encryptString(publicKey: CryptoKey, plaintext: string): Promise<ArrayBuffer>
  decryptString(privateKey: CryptoKey, encrypted: ArrayBuffer): Promise<string>
}
```

### `useRoom` - Vue3 Composable
```typescript
function useRoom(roomId: string) {
  return {
    messages: Ref<Message[]>
    peers: Ref<Peer[]>
    currentUserId: Ref<string>
    currentUsername: Ref<string>
    isConnected: Ref<boolean>
    joinRoom: () => Promise<void>
    sendChatMessage: (text: string) => void
    updateUsername: (name: string) => Promise<void>
    leaveRoom: () => void
  }
}
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: Vue 3 (Composition API)
- **è¯­è¨€**: TypeScript
- **æ„å»ºå·¥å…·**: Vite
- **P2P åº“**: Trystero (åŸºäº WebTorrent)
- **å®æ—¶é€šä¿¡**: WebRTC
- **åŠ å¯†**: Web Crypto API (RSA-OAEP)
- **æœ¬åœ°å­˜å‚¨**: localforage
- **UUID**: uuid

## ğŸŒŸ ç‰¹è‰²åŠŸèƒ½

### è‡ªåŠ¨å¯†é’¥ç®¡ç†
- é¦–æ¬¡è®¿é—®è‡ªåŠ¨ç”Ÿæˆ RSA å¯†é’¥å¯¹
- å¯†é’¥æŒä¹…åŒ–å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°
- è‡ªåŠ¨åœ¨ peers ä¹‹é—´äº¤æ¢å…¬é’¥

### æˆ¿é—´ç³»ç»Ÿ
- æ”¯æŒåˆ›å»ºéšæœºæˆ¿é—´ï¼ˆUUIDï¼‰
- æ”¯æŒåŠ å…¥æŒ‡å®šæˆ¿é—´ ID
- URL å‚æ•°å…±äº«æˆ¿é—´é“¾æ¥
- ä¸€é”®å¤åˆ¶æˆ¿é—´é‚€è¯·é“¾æ¥

### ç”¨æˆ·ä½“éªŒ
- å®æ—¶åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
- æ¶ˆæ¯æ—¶é—´æˆ³æ˜¾ç¤º
- è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
- ç°ä»£åŒ–æ¸å˜ UI è®¾è®¡

## ğŸ”’ å®‰å…¨æ€§

### åŠ å¯†æœºåˆ¶
- **RSA-OAEP**: 2048 ä½éå¯¹ç§°åŠ å¯†
- **SHA-256**: å“ˆå¸Œç®—æ³•
- **ç«¯åˆ°ç«¯**: æ¶ˆæ¯åœ¨å‘é€ç«¯åŠ å¯†ï¼Œæ¥æ”¶ç«¯è§£å¯†

### éšç§ä¿æŠ¤
- æ¶ˆæ¯ä¸ç»è¿‡æœåŠ¡å™¨
- ä¸æŒä¹…åŒ–èŠå¤©è®°å½•
- å¯†é’¥ä»…å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨
- æˆ¿é—´ ID å¯è‡ªå®šä¹‰ï¼Œä¸å…¬å¼€

## âš ï¸ é™åˆ¶ä¸æ³¨æ„äº‹é¡¹

1. **æµè§ˆå™¨å…¼å®¹æ€§**: éœ€è¦æ”¯æŒ WebRTC å’Œ Web Crypto API çš„ç°ä»£æµè§ˆå™¨
2. **ç½‘ç»œè¦æ±‚**: æŸäº›ç½‘ç»œç¯å¢ƒå¯èƒ½æ— æ³•å»ºç«‹ P2P è¿æ¥ï¼ˆéœ€è¦ TURN æœåŠ¡å™¨ï¼‰
3. **æ¶ˆæ¯ä¸æŒä¹…åŒ–**: å…³é—­æµè§ˆå™¨åæ‰€æœ‰æ¶ˆæ¯æ¸…é™¤
4. **æˆ¿é—´å®‰å…¨**: æˆ¿é—´ ID æ˜¯å”¯ä¸€çš„å®‰å…¨å‡­è¯ï¼Œéœ€å¦¥å–„åˆ†äº«

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºæˆ¿é—´
1. æ‰“å¼€åº”ç”¨
2. ç‚¹å‡»"åˆ›å»ºæ–°æˆ¿é—´"
3. å¤åˆ¶æˆ¿é—´é“¾æ¥åˆ†äº«ç»™æœ‹å‹

### åŠ å…¥æˆ¿é—´
1. è·å–æˆ¿é—´é“¾æ¥æˆ–æˆ¿é—´ ID
2. è¾“å…¥æˆ¿é—´ ID ç‚¹å‡»"åŠ å…¥æˆ¿é—´"
3. å¼€å§‹èŠå¤©

## ğŸ› ï¸ å¼€å‘è®¡åˆ’

- [ ] æ–‡ä»¶ä¼ è¾“åŠŸèƒ½
- [ ] è§†é¢‘/éŸ³é¢‘é€šè¯
- [ ] å±å¹•å…±äº«
- [ ] æ›´å¤šåŠ å¯†ç®—æ³•æ”¯æŒ
- [ ] ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ–
- [ ] å¤šè¯­è¨€æ”¯æŒ

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº Chitchatter çš„æ ¸å¿ƒç†å¿µå¼€å‘ï¼Œç”¨äºå­¦ä¹ å’Œæ¼”ç¤ºç›®çš„ã€‚

## ğŸ™ è‡´è°¢

- [Chitchatter](https://github.com/jeremyckahn/chitchatter) - æ ¸å¿ƒæ¶æ„çµæ„Ÿæ¥æº
- [Trystero](https://github.com/dmotz/trystero) - P2P è¿æ¥åº“
- [Vue.js](https://vuejs.org/) - æ¸è¿›å¼ JavaScript æ¡†æ¶

---

**ğŸ‰ äº«å—ç§å¯†ã€å®‰å…¨çš„ P2P èŠå¤©ä½“éªŒï¼**
